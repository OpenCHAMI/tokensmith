<!--
Copyright Â© 2025 OpenCHAMI a Series of LF Projects, LLC

SPDX-License-Identifier: MIT
-->

# Authelia Configuration

This directory contains the Authelia configuration for TokenSmith integration testing.

## Key Generation

The Authelia configuration uses a dynamic key generation approach to avoid committing private keys to git:

### How It Works

1. **External Key Generation**: Keys are generated outside the container using the host system's `openssl`
2. **Pre-flight Setup**: The `setup-authelia.sh` script runs before docker-compose
3. **Configuration Creation**: The script creates a complete config file with embedded keys
4. **Cleanup**: Temporary key files are removed after configuration creation

### Files

- `configuration.yml` - Main Authelia configuration (generated by script)
- `generate-keys.sh` - Script that generates RSA keys and creates configuration
- `users_database.yml` - User database for authentication
- `../setup-authelia.sh` - Main setup script that runs before docker-compose

### Security

- Private keys are never committed to git
- Keys are generated fresh on each setup run
- Temporary key files are cleaned up automatically
- The `.gitignore` excludes generated key files

### Usage

1. **Run Setup**: Execute the setup script before starting containers:
   ```bash
   ./tests/integration/setup-authelia.sh
   ```

2. **Start Containers**: Run docker-compose normally:
   ```bash
   docker-compose up
   ```

The key generation happens outside the container using the host system's tools, making it more reliable and secure.

## Configuration

The configuration includes:

- **Server**: HTTP server on port 9091
- **Authentication**: File-based backend with Argon2id
- **Access Control**: One-factor authentication for all domains
- **Session**: Basic session management
- **Storage**: Local SQLite database
- **OIDC**: TokenSmith client with dynamic key generation 